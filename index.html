<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ú–æ–π –≤–∏—à–ª–∏—Å—Ç üéÅ</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 32px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f5f5f5; }
    .clickable { cursor: pointer; color: #999; }
    .form-container { margin-top: 20px; }
    .form-container input, .form-container select, .form-container button {
      margin: 8px 0;
      padding: 10px;
      width: 100%;
      font-size: 16px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
  </style>
  <script>
    function reveal(span, text) {
      span.innerText = text;
      span.style.color = '#000';
    }

    function showForm(type, id = '') {
      document.getElementById(type + '-form').style.display = 'block';
      if (id) {
        // Pre-fill form with existing gift details
        fetchGiftDetails(id);
      }
    }

    function fetchGiftDetails(id) {
      // Assuming you have a route to fetch gift details by id
      fetch(`/admin/gift/${id}`)
        .then(response => response.json())
        .then(gift => {
          document.getElementById('gift-title').value = gift.title;
          document.getElementById('gift-description').value = gift.description;
          document.getElementById('gift-link').value = gift.link;
          document.getElementById('gift-category').value = gift.category;
        });
    }
  </script>
</head>
<body>
  <h1>–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ –º–æ–π –≤–∏—à–ª–∏—Å—Ç üéÅ</h1>
  <p>–ù–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤—ã–±–∏—Ä–∞—Ç—å —á—Ç–æ-—Ç–æ –∏–∑ —Å–ø–∏—Å–∫–∞, –º–Ω–µ –ø—Ä–∏—è—Ç–Ω–æ –ª—é–±–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µüíï</p>
  <p>–ù–æ –≤–æ—Ç —Å–ø–∏—Å–æ–∫ –≤–µ—â–∏—Ü, –æ –∫–æ—Ç–æ—Ä—ã—Ö —è –º–µ—á—Ç–∞—é –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –æ—á–µ–Ω—å —Ö–æ—á—ÉüòÑ</p>
  <p>–ß—Ç–æ–±—ã –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å ‚Äî –≤–æ–π–¥–∏ —á–µ—Ä–µ–∑ Telegram</p>
 
  <!-- Telegram Login Widget -->
  <script async src="https://telegram.org/js/telegram-widget.js?22"
    data-telegram-login="MariiaWishlistBot" 
    data-size="large"
    data-userpic="false"
    data-onauth="onTelegramAuth(user)">
  </script>

  <div id="list">
    <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
  </div>

  <h2>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø–æ–¥–∞—Ä–æ–∫</h2>
  <div class="form-container" id="add-form">
    <input type="text" id="gift-title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ–¥–∞—Ä–∫–∞" required>
    <input type="text" id="gift-description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–¥–∞—Ä–∫–∞" required>
    <input type="url" id="gift-link" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–¥–∞—Ä–æ–∫" required>
    <select id="gift-category">
      <option value="–°–∞–º—ã–µ –∂–µ–ª–∞–Ω–Ω—ã–µ">–°–∞–º—ã–µ –∂–µ–ª–∞–Ω–Ω—ã–µ</option>
      <option value="–ó–¥–æ—Ä–æ–≤—å–µ">–ó–¥–æ—Ä–æ–≤—å–µ</option>
      <option value="–ü–æ–ª–µ–∑–Ω–æ—Å—Ç–∏">–ü–æ–ª–µ–∑–Ω–æ—Å—Ç–∏</option>
      <option value="–ü—Ä–∏—è—Ç–Ω–æ—Å—Ç–∏">–ü—Ä–∏—è—Ç–Ω–æ—Å—Ç–∏</option>
      <option value="–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ">–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ</option>
    </select>
    <button onclick="addGift()">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫</button>
  </div>

  <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–∞—Ä–æ–∫</h2>
  <div class="form-container" id="edit-form" style="display: none;">
    <input type="text" id="edit-gift-title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ–¥–∞—Ä–∫–∞" required>
    <input type="text" id="edit-gift-description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–¥–∞—Ä–∫–∞" required>
    <input type="url" id="edit-gift-link" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ–¥–∞—Ä–æ–∫" required>
    <select id="edit-gift-category">
      <option value="–°–∞–º—ã–µ –∂–µ–ª–∞–Ω–Ω—ã–µ">–°–∞–º—ã–µ –∂–µ–ª–∞–Ω–Ω—ã–µ</option>
      <option value="–ó–¥–æ—Ä–æ–≤—å–µ">–ó–¥–æ—Ä–æ–≤—å–µ</option>
      <option value="–ü–æ–ª–µ–∑–Ω–æ—Å—Ç–∏">–ü–æ–ª–µ–∑–Ω–æ—Å—Ç–∏</option>
      <option value="–ü—Ä–∏—è—Ç–Ω–æ—Å—Ç–∏">–ü—Ä–∏—è—Ç–Ω–æ—Å—Ç–∏</option>
      <option value="–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ">–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ</option>
    </select>
    <button onclick="updateGift()">–û–±–Ω–æ–≤–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫</button>
  </div>

  <h2>–°–ø–∏—Å–æ–∫ –ø–æ–¥–∞—Ä–∫–æ–≤</h2>
  <table id="gift-table">
    <tr>
      <th>–ü–æ–¥–∞—Ä–æ–∫</th>
      <th>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
      <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
      <th>–°—Å—ã–ª–∫–∞</th>
      <th>–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</th>
      <th>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</th>
      <th>–£–¥–∞–ª–∏—Ç—å</th>
      <th>–ü–æ–¥–∞—Ä–µ–Ω</th>
    </tr>
  </table>

  <script>
    let user = null;

    function onTelegramAuth(u) {
      user = u;
      loadGifts();
    }

    async function loadGifts() {
      const res = await fetch("https://my-wishlist.onrender.com/wishlist");
      const gifts = await res.json();
      const container = document.getElementById('gift-table');
      container.innerHTML = '';
      
      gifts.forEach(gift => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${gift.title}</td>
          <td>${gift.category}</td>
          <td>${gift.desc}</td>
          <td><a href="${gift.link}" target="_blank">–°—Å—ã–ª–∫–∞</a></td>
          <td><button ${gift.reserved ? 'disabled' : ''} onclick="reserveGift(${gift.id})">${gift.reserved ? '–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ' : '–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å'}</button></td>
          <td><button onclick="showForm('edit', ${gift.id})">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button></td>
          <td><button onclick="deleteGift(${gift.id})">–£–¥–∞–ª–∏—Ç—å</button></td>
          <td><button onclick="markGiftAsGiven(${gift.id})">–ü–æ–¥–∞—Ä–µ–Ω</button></td>
        `;
        container.appendChild(row);
      });
    }

    async function addGift() {
      const title = document.getElementById('gift-title').value;
      const description = document.getElementById('gift-description').value;
      const link = document.getElementById('gift-link').value;
      const category = document.getElementById('gift-category').value;
      
      const response = await fetch("https://my-wishlist.onrender.com/admin/gift/add", {
        method: "POST",
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ title, description, link, category })
      });

      if (response.ok) {
        loadGifts();
      } else {
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø–æ–¥–∞—Ä–∫–∞');
      }
    }

    async function updateGift() {
      const title = document.getElementById('edit-gift-title').value;
      const description = document.getElementById('edit-gift-description').value;
      const link = document.getElementById('edit-gift-link').value;
      const category = document.getElementById('edit-gift-category').value;
      
      const response = await fetch("https://my-wishlist.onrender.com/admin/gift/update", {
        method: "POST",
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ title, description, link, category })
      });

      if (response.ok) {
        loadGifts();
      } else {
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø–æ–¥–∞—Ä–∫–∞');
      }
    }

    async function deleteGift(id) {
      const response = await fetch(`https://my-wishlist.onrender.com/admin/gift/delete/${id}`, {
        method: "DELETE"
      });

      if (response.ok) {
        loadGifts();
      } else {
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–¥–∞—Ä–∫–∞');
      }
    }

    async function markGiftAsGiven(id) {
      const response = await fetch(`https://my-wishlist.onrender.com/admin/gift/given/${id}`, {
        method: "PATCH"
      });

      if (response.ok) {
        loadGifts();
      } else {
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–∞—Ä–∫–∞');
      }
    }

    loadGifts();
  </script>

</body>
</html>
